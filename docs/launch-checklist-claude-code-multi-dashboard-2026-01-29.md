# Чеклист “beta-ready” для запуска (Claude Code + multi-account dashboard)

Цель: безопасно и предсказуемо генерировать один BI-дашборд по нескольким профилям `account_id` через MCP `yandexad`.

## 1) Accounts registry (`accounts.json`)
- `id` у каждого профиля **уникальный**.
- Для каждого профиля задан `direct_client_login`.
- Для каждого профиля задан ровно один счётчик: `metrica_counter_ids: ["<counter_id>"]`.
  - Если счётчиков несколько — при генерации нужно явно передавать `counter_id`.
  - Если счётчика нет — профиль будет в `accounts_errors` в multi-dashboard.

## 2) `.env` / права
- Токены Direct/Metrica валидны и не логируются.
- `YANDEX_DIRECT_SANDBOX=false` (для прод-сценария).
- Если нужно добавлять/править профили из Claude: `MCP_ACCOUNTS_WRITE_ENABLED=true` и корректный `MCP_ACCOUNTS_FILE`.

## 3) Рекомендованные параметры генерации
- Multi-account:
  - `all_accounts=true` (или `account_ids=[...]` чтобы исключать проблемные профили).
  - `output_dir` обязателен (чтобы не упираться в лимиты токенов в чат-клиентах).
  - `return_data=false` (быстрее/меньше ответ; полные данные остаются в JSON/HTML).
- Период:
  - `date_to` можно задавать “сегодня” — MCP автоматически сдвинет на “вчера”, т.к. “сегодня” часто неполное в Direct/Метрике.

## 4) UI sanity-check (в одном HTML)
- Переключение аккаунтов (справа сверху) меняет KPI/графики/таблицы.
- Переключатель `Все / Поиск / РСЯ / Не классифицировано` работает:
  - в `Не классифицировано` для Direct KPI допустимы `—` (расход/показы/клики не атрибутируются).
- “Цели”:
  - Переключение `Директ / Все источники` работает.
  - Выбор цели в селекте работает.
- “Источники”:
  - Нет одинаковых цветов у разных линий на одном графике.
- Воронки:
  - “Сайт (все источники)” и “Директ (атрибуция Метрики)” считаются отдельно.

## 5) Контроль warnings/errors
- Warning `UTMCampaign engine filter rejected` допустим: split Поиск/РСЯ может быть менее точным, но данные есть.
- Если есть `accounts_errors`:
  - Это блокер для “готово”, пока не понятна причина (обычно: нет прав на счётчик/не задан `metrica_counter_ids`/конфликт логина).

## 6) Операционные договорённости
- Канонический каталог для артефактов, например: `~/crew_a/voicexpert/dashboards`.
- Частота обновления: минимум “раз в день утром”; “сегодня” в отчёте всё равно исключается автоматически.

